---
title: 'Argenomic: Illuminating Chemical Space'
date: 2020-07-05
permalink: /posts/2020/07/argenomic/
tags:
  - Evolutionary Algorithms
  - Computational Drug Design 
  - Software Package
---

![logo](/images/logo.png)

Chemists search through the space of molecules to discover new drugs, often aided by search algorithms, which automatically explore a search space to
find high-performing solutions. With argenomic we provide a novel type of software, based on a [paper](https://chemrxiv.org/articles/Illuminating_Elite_Patches_of_Chemical_Space/12608228/1) by [Jeriek Van den Abeele](https://www.mn.uio.no/fysikk/english/people/aca/jeriek-van-den-abeele/) and me. Argenomic produces a large diversity of high-performing, yet qualitatively different molecules, illuminates the fitness of molecules over chemical space, and improves search efficiency compared to both machine learning and genetic algorithm approaches.

Shining a light on chemical space
------

The goal of a classical optimisation algorithm is to obtain the highest performing solution in a search space. If the exact mathematical form of the evaluation function is inaccessible, as is typically the case in molecular optimisation, heuristic search methods tend to become a necessity. Many of these heuristic methods are inspired by biological phenomena. Genetic algorithms are based on the theory of evolution and aim to optimise with regard to an evaluation function, incrementally improving on existing solutions. Specifically, novel solutions are generated by randomly changing or stochastically combining solutions from the existing population. In the genetic algorithm community, these two operations are respectively known as *mutations* and *crossovers*. Genetic algorithms can be highly effective in straightforward optimisation problems, but are known to struggle when trying to cross low-performing valleys or to break out of local optima, both of these occurrences can lead to evolutionary stagnation. 

![surface](/images/surface_final.png)
*Figure 1. Example of illumination in a 2D representation of chemical space. In this case the fitness is determined as the molecular similarity to [Troglitazone](https://en.wikipedia.org/wiki/Troglitazone).*

Argenomic evades evolutionary stagnation by enforcing molecular diversity and speeds up the optimisation process by decoupling mutations from crossovers, and introduces the concept of positional analogue scanning to genetic algorithms. In argenomic, candidate solutions are generated by a genetic algorithm but are assigned to a niche -- in which only the single fittest candidate survives -- depending on user-defined characterising features. Dividing the search space into feature-based niches and explicitly enforcing population diversity stands in stark contrast with classical genetic algorithms which typically only retain the top high-scoring solutions regardless of their diversity, or lack thereof. The enforced variation between niches makes crossovers more diverse, and by mutating existing solutions, potent scaffolds can spread into other niches. Most importantly, because at every generation argenomic contains solutions spread out over feature space, diverse solutions in far-away niches can be used a resource to escape stagnation. 

![surface](/images/comparison_GBGA_GBEPI-1.png)
*Figure 2. Performance of a genetic algoritm (GB-GA) and argenomic (GB-EPI) for the rediscovery of [Celecoxib](https://en.wikipedia.org/wiki/Celecoxib), illustrated by the best score of each generation over 100 independent runs. For each run, the starting populations consisted of 40 random compounds from the ZINC database.*

The fitness score obtained by the molecule occupying a niche at the end of an argenomic run represents the capability of the corresponding part of feature space to contain high-performance molecules. In this way, argenomic *illuminates* the relationship between the chosen features of interest and how varying them affects performance, either positively or, equally relevant, negatively. As can be seen in Figure 1, the molecules at the end of a argenomic run form a patchwork of locally elite solutions -- with respect to the global evaluation function -- in chemical space. In Figure 2, the difference in performance between argenomic and a genetic algoritm is shown.

Handing over the reins
------

In practical terms, users of argenomic can choose their own features of interest, and define relevant ranges of variation to construct a feature space. If, for instance, a user wants to find medicinally relevant molecules in chemical space, they could construct a feature space based on physicochemical properties like lipophilicity and molecular mass, and practical concerns like synthetic accessibility. The chosen ranges in which to explore these features can be used to specify  a desired subset of chemical space in which to generate new molecules. To use the argenomic software, simply open the terminal, activate the right conda environent and run:

```
python3 illuminate.py configuration_file=./configuration/config.yaml generations=50
```

After intialisation (mainly needed to set-up the niches), every generation the maximum fitness, the mean fitness, and standard deviation are printed. The percentual amount of niches that are filled is also printed every generation. Which options of the argonomic software are used is determined in the configuration file. For example, our config.yaml file determines the initial pool of molecules (100 molecules from guacamol), the batch size of molecules mutated every generation (40), where to store the results, how many niches are used (150), which properties are used to make the niches (ExactMolWt, MolLogP, TPSA, MolMR all from [RDKit](https://www.rdkit.org/docs/GettingStartedInPython.html)), and which structural alerts (Glaxo) are used to filter out unwanted molcules:

```
---
data_file: ./data/smiles/guacamol_initial_rediscovery_thiotixene.smi
batch_size: 40
initial_size: 100
archive:
  name: ./results/thiotixene
  size: 150
  accuracy: 25000
descriptor:
  properties:
  - Descriptors.ExactMolWt
  - Descriptors.MolLogP
  - Descriptors.TPSA
  - Crippen.MolMR
  ranges:
  - - 225
    - 555
  - - -0.5
    - 5.5
  - - 0
    - 140
  - - 40
    - 130
fitness:
  target: CN(C)S(=O)(=O)c1ccc2Sc3ccccc3C(=CCCN4CCN(C)CC4)c2c1
  type: ECFP4
arbiter:
  rules:
  - Glaxo
```
In our code, only similarity metrics can be used as fitness (the target and fingerprint type are specified in the configuration file), but users can easily replace this with their fitness function of choice. The set of mutations can also be changed easily: each mutation is stored as a [SMARTS pattern](https://www.daylight.com/dayhtml/doc/theory/theory.smarts.html) and stored in *argenomic/data/smarts/mutation_collection.tsv*. For now, the crossover operator is still hard-coded. Future versions of the code will include support for flexible concurrency and a more dynamic command line interface. Other features, or bugs, can be requested/reported via the [github issues](https://github.com/Jonas-Verhellen/Argenomic/issues) or via private communication.

Standing on the shoulders of giants
------
As in all creative endeavors, the ideas behind argenomic were not born in a vaccuum. The projected was kickstarted by discovering the [multi-dimensional archive of phenotypic elites](https://arxiv.org/abs/1504.04909) (MAP-Elites) as devised by [Jean-Baptiste Mouret](https://members.loria.fr/JBMouret/) and [Jeff Clune](http://jeffclune.com/). MAP-Elites is a simple, efficacious and surprisingly powerful tool developed in the context of soft robot design, which solves stagnation issues in genetic algorithms by mimicking biological evolutionary diversity as described above. We settled on a [graph-based genetic algorithm](https://pubs.rsc.org/en/content/articlelanding/2019/SC/C8SC05372C#!divAbstract) as our underlying molecular optimisation tool. In a graph-based genetic algorithm, candidate molecules are represented by their molecular graph and mutations and crossovers are implemented as actions on the graph. Thanks to [Jan H. Jensen](https://chem.ku.dk/ansatte/alle/?pure=en/persons/300883) a fully [open-source implementation](https://github.com/jensengroup/GB-GA) was available. In-depth technical discussions can be found in our [accompanying paper](https://chemrxiv.org/articles/Illuminating_Elite_Patches_of_Chemical_Space/12608228/1). 

The [source code](https://github.com/Jonas-Verhellen/Argenomic) of argenomic can be found on github. 
